---
- name: current date time
  debug: 
    msg: "{{lookup('pipe','date \"+%Y-%m-%d %H:%M\"')}}"

- name: "node-red stop"
  shell:
    cmd: "service nodered stop"

- set_fact:
    pi_password: "{{lookup('file', '{{ pswrdfile }}') }}"

- set_fact:
    pi_passwrd: "{{ pi_password | password_hash('sha512' ) }}"

- set_fact:
    slack_tken: "{{lookup('file', '{{ slackfile }}') }}"

- set_fact:
    slack_token: "{{ slack_tken | password_hash('sha512' ) }}"    

- name: "Copy file {{ flow }}"
  template:
    src: "templates/{{ flow }}"
    dest: /home/pi/.node-red/flows_raspberrypi.json
    owner: pi
    group: pi
    mode: 0644   

- name: "node-red force-reload"
  shell:
    cmd: "service nodered force-reload"

- name: "node-red start"
  shell:
    cmd: "service nodered start"

  