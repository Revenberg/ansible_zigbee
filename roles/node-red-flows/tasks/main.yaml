---
- name: current date time
  debug: 
    msg: "{{lookup('pipe','date \"+%Y-%m-%d %H:%M\"')}}"

- name: "node-red stop"
  shell:
    cmd: "service nodered stop"

- set_fact:
    pi_password: "{{lookup('file', '{{ pswrdfile }}') }}"

- set_fact:
    pi_passwrd: "{{ slack_token | password_hash('sha512' ) }}"

- set_fact:
    slack_token: "{{lookup('file', '{{ pswrdfile }}') }}"

- set_fact:
    slack_token: "{{ slack_token | password_hash('sha512' ) }}"    

- name: Copy file Zigbee.json
  template:
    src: templates/Zigbee.json
    dest: /home/pi/.node-red/flows_raspberrypi.json
    owner: pi
    group: pi
    mode: 0644   

- name: "node-red force-reload"
  shell:
    cmd: "service nodered force-reload"

- name: "node-red start"
  shell:
    cmd: "service nodered start"

  